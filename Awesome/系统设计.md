# 《系统设计》



## 框架



### 基础工具库

#### Apache commons

- Commons IO
  - `FileAlterationMonitor`和`FileAlterationObserver`（Alyx曾发现这里每隔10秒会涨10M内存，待研究）
- Commons Lang3等



#### Google Guava 

Google Guava 是 Google 公司内部 Java 开发工具库的开源版本。Google 内部的很多 Java 项目都在使用它。它提供了一些 JDK 没有提供的功能，以及对 JDK 已有功能的增强功能。

- 主要包括了：
  1. 集合（Collections）
  2. 缓存（Caching）
  3. **原生类型支持**（Primitives Support）
  4. **并发库**（Concurrency Libraries）
  5. 通用注解（Common Annotation）
  6. 字符串处理（Strings Processing）
  7. 数学计算（Math）
  8. I/O事件
  9. **总线（EventBus）**
- 一些有用的小工具：
  1. `BloomFilter`布隆过滤器的实现

- 源码分析：[https://ifeve.com/google-guava](https://ifeve.com/google-guava/)



#### Json

- [关于Gson的几个坑](https://ariescat.top/2020/03/12/%E5%85%B3%E4%BA%8EGson%E7%9A%84%E5%87%A0%E4%B8%AA%E5%9D%91/)



### Spring

#### Spring

> 最好能抽空看看源码，最起码bean的生命周期，如何解决循环依赖，父子容器，还有boot的启动流程，事务实现原理，动态代理原理等，你知道越多越好。

- [Spring源码浅析](https://blog.csdn.net/linuu/column/info/lovespring)

- Spring AOP

  - AOP原理，ProxyFactory

  - AOP中Pointcut，Advice 和 Advisor 三个概念 还有Advised

    > Advised->在Spring中创建了AOP代理之后，就能够使用org.springframework.aop.framework.Advised接口对它们进行管理。 任何AOP代理都能够被转型为这个接口，不论它实现了哪些其它接口
    >
    > Advisor->类似使用Aspect的@Aspect注解的类
    >
    > Advice->@Before、@After、@AfterReturning、@AfterThrowing、@Around
    >
    > Pointcut->@Pointcut

- Spring tx

  `<tx:annotation-driven/>`的理解

- [Spring Cache 介绍](https://www.cnblogs.com/rollenholt/p/4202631.html)

- [Spring Webflux](https://www.jianshu.com/p/c029de45d23b) （reactive web框架，与前端Flux架构名字相同）

  命令式编程 VS **响应式编程**

- Spring Data

  - [Spring Data JPA 简单查询--接口方法 - 如莲家园 - 博客园](https://www.cnblogs.com/rulian/p/6557471.html)

- 与其他构架的整合

  - [企业大型互联网分布式架构{Java分布式架构 dubbo+springmvc+mybatis+ehcach+redis }-IT未来-ITPUB博客](http://m.blog.itpub.net/31452580/viewspace-2148363/)
  - [手把手教你从最基本的Java工程搭建SpringMVC+SpringDataJPA+Hibernate(含源码下载) - anxpp的博客 - CSDN博客](http://blog.csdn.net/anxpp/article/details/51415366)



#### SpringBoot

TODO



#### SpringCloud

TODO



### ASM神器

spring-core自带有asm，org.ow2.asm也是一个轻量级的jar

还有byte buddy库，javassist库



### JAX-RS

全称：Java API for RESTful Web Services，是一套用java实现REST服务的规范，提供了一些标注将一个资源类，一个POJOJava类，封装为Web资源。

包括：

- @Path，标注资源类或方法的相对路径
- @GET，@PUT，@POST，@DELETE，标注方法是用的HTTP请求的类型
- @Produces，标注返回的MIME媒体类型
- @Consumes，标注可接受请求的[MIME](http://liugang594.iteye.com/wiki/MIME)媒体类型
- @PathParam，@QueryParam，@HeaderParam，@CookieParam，@MatrixParam，@FormParam，分别标注方法的参数来自于HTTP请求的不同位置，例如@PathParam来自于URL的路径，@QueryParam来自于URL的查询参数，@HeaderParam来自于HTTP请求的头信息，@CookieParam来自于HTTP请求的Cookie

`Eureka`的`ApplicationResource`有用到



### 缓存

- Guava的缓存

  Guava Cache说简单点就是一个支持**LRU**的ConcurrentHashMap

  1. [简析guava cache线程安全设计哲学 - 简书 (jianshu.com)](https://www.jianshu.com/p/699869cb5421)

- **Caffeine** 来自未来的缓存

  Caffeine是基于JAVA 1.8 Version的高性能缓存库。Caffeine提供的内存缓存使用参考Google guava的API。Caffeine是基于Google Guava Cache设计经验上改进的成果。



### 时间库

- **joda** 对时间的操作
- Quartz 定时任务



### 日志

- 区分`commons-logging`，`slf4j`，`log4j`，`logback`
  1. 了解`jcl-over-slf4j`，`jul-to-slf4j`这些jar的作用
  2. 了解`log4j`和`log4j2`的区别，**`lmax disruptor`**应用场景
- **`Flume`** 日志采集系统，一般用于日志聚合



### ORM库

- hibernate

  查询：HQL查询，QBC查询，SQL查询

  级联查询：一对一，一对多（多对一），多对多；懒加载，1+n问题

  其他：

  1. session.get(): 非懒加载方法

     session.load(): 默认就是是懒加载

  2. 抓取策略（fetch）和 懒加载（lazy）



### Netty

- [概述](https://www.jianshu.com/p/1a6d1a25e6cc)

- Netty的线程模型

  通过**Reactor模型**基于**多路复用器**接收并处理用户请求，内部实现了两个线程池，boss线程池和work线程池，其中boss线程池的线程负责处理请求的accept事件，当接收到accept事件的请求时，把对应的socket封装到一个NioSocketChannel中，并交给work线程池，其中work线程池负责请求的read和write事件

- NioEventLoop设计原理

- 定时任务的原理

- **netty对象池使用与回收**

- 时间轮算法

  [HashedWheelTimer](http://novoland.github.io/%E5%B9%B6%E5%8F%91/2014/07/26/%E5%AE%9A%E6%97%B6%E5%99%A8%EF%BC%88Timer%EF%BC%89%E7%9A%84%E5%AE%9E%E7%8E%B0.html)

  > hashWheel定时器和Quartz的区别：  
  > 1）Quartz将定时任务分为任务和触发器，而hashWheel只有任务的概念
  >
  > 2）Quartz通过一个TreeSet对所有的触发器进行管理，而hashWheel通过一个hash轮来对所有的任务进行管理
  >
  > 3）Quartz能够非常方便的删除定时任务，而netty的hashWheel暂时没有删除任务的接口（除非自己实现一个hashWheel定时器）
  >
  > 4）Quartz有一个专门的调度线程对任务进行管理，任务执行有另外专门的线程池，而hashWheel用一个线程实现对任务的管理和任务的执行。
  >
  > 5）Quartz能够通过序列化，将定时任务保存在数据库，而hashWheel不能
  >
  > 总的来说，Quartz的功能相对强大，而hashWheel相对要轻量级一点。

- 附：

  个人认为netty对用户来说是异步，但是实际底层IO是IO多路复用模型，本质上还是一种同步非阻塞（是的，个人认为IO多路复用模型还是**同步**非阻塞，并且[**真正的IO操作**都将**阻塞**应用线程](https://weread.qq.com/web/reader/1e732510718f63a11e7dee2k98f3284021498f137082c2e)），他只是多了一个Selector（需要底层操作系统支持），如此一个线程就可以控制大量的通信（相比传统IO，不管他是不是非阻塞）。

  另看 [IO#IO概念](#io)，这里也收录了一些理解



### 逆向工程

- [Java代码生成利器之rapid-generate应用](http://blog.csdn.net/likeaboy_fire/article/details/44024987)



### Disruptor

- 背景

  1. [锁的缺点 - Disruptor 入门](http://wiki.jikexueyuan.com/project/disruptor-getting-started/lock-weak.html)

  2. 并发中的伪共享问题

  3. 代码的并发执行大约是两件事：互斥和变化的可见性。

     互斥是关于管理某些资源的竞争更新。

     变化的可见性是关于控制何时使这些更改对其他线程可见。

- 设计上的优势

  1. 内部数据存储使用环形缓冲（Ring Buffer），这样分配支持了**CPU缓存位置预测**，**GC的压力更小**
  2. **尽量使用无锁设计，合理使用CAS**
  3. 优化数据结构（填充缓存行），**解决伪共享问题**
  4. 合理位运算（如2次方幂求模），**合理使用Unsafe**

- 策略

  `WaitStrategy`可以选择`YieldingWaitStrategy`（无锁）

- 参考博客

  1. [解读Disruptor系列](https://www.jianshu.com/u/4c940e688e05)，这个系列挺好的，他每篇文章后面都有份参考资料，也可以认真看看

- 扩展

  1. AtomicXXX.lazySet 这个方法的作用（Sequence#set相当于AtomicLong#lazySet）
  2. Unsafe类的作用？为什么要用这个类？除了JDK，在Netty、Spring、Kafka、Storm等非常多的流行开源项目中都使用了Unsafe



### 原子类型集合库

避免开销很大的装箱/拆箱操作，节省了原始类型装箱消耗的内存

- **Koloboke**

  [生成高性能的 JAVA 基本类型 map/set](https://blog.csdn.net/qinyongye/article/details/81282961)

- Eclipse Collections



### RxJava 

[➮详细](/2019/01/29/事件驱动编程RxJava/)

" a library for composing asynchronous and event-based programs using observable sequences for the Java VM "  （一个在 Java VM 上使用可观测的序列来组成异步的、基于事件的程序的库）





## 工具

- 构建工具
  - Maven
  - Gradle
    - [十分钟理解Gradle - Bonker - 博客园](https://www.cnblogs.com/Bonker/p/5619458.html)
    - 慕课实战：Gradle3.0自动化项目构建技术精讲+实战
- 版本管理工具
  - Git
- 持续集成部署
  - Jenkins





## 中间件

### ActiveMQ

TODO



### Elasticsearch

- [Elasticsearch基础教程 - CSDN博客](http://blog.csdn.net/cnweike/article/details/33736429)
- [玩转单元测试之DBUnit - WadeXu - 博客园](https://www.cnblogs.com/wade-xu/p/4547381.html)
- [基于注解的配置 - Spring-Data-Elasticsearch](https://es.yemengying.com/5/5.1/5.1.2.html)



### Akka

- **Actor模型**
- [akka设计模式系列-基础模式](https://yq.aliyun.com/articles/616951?spm=a2c4e.11153940.blogcont616952.14.28751adcybgYqt)



### Zookeeper

- [Zookeeper的功能以及工作原理](https://www.cnblogs.com/felixzh/p/5869212.html)
- [Leader选举-选举过程介绍比较清晰](https://blog.csdn.net/gaoshan12345678910/article/details/67638657)
- [ZAB协议理解](https://blog.csdn.net/junchenbb0430/article/details/77583955)





## 编程思想

### Reative（响应式）编程

Reactive响应式(反应式)编程 是一种新的编程风格，其特点是异步或并发、事件驱动、推送PUSH机制以及观察者模式的衍生。

JVM应用：RxJava、Akka、Actors模型、Vert.x、Webflux



### 领域驱动设计

> 他是综合软件系统分析和设计的面向对象**建模方法**，如今已经发展为一种针对大型复杂系统的领域建模与分析方法。
>
> 将要解决的**业务概念和业务规则**转换为**软件系统中的类型及类型的属性与行为**，**通过合理运用面向对象的封装、继承、多态等设计要素**，降低或隐藏整个系统的业务复杂性，并使得系统具有更好的扩展性，应对纷繁多变的现实业务问题。
>
> ——抄录于《高可用可伸缩微服务架构：基于Dubbo、Spring Cloud和Service Mesh》2.1节

- [领域驱动设计在互联网业务开发中的实践](https://tech.meituan.com/2017/12/22/ddd-in-practice.html)
- [美团DDD实践 示例项目](https://github.com/1987539447/draw-lottery)



## 分布式

- 理论基石CAP原理

  **C** - **C**onsistent ，一致性

  **A** - **A**vailability ，可用性

  **P** - **P**artition tolerance ，分区容忍性

  一句话概括 CAP 原理就是——**网络分区发生时，一致性和可用性两难全**

- 一致性Hash

- RPC

  RPC涉及：通讯，序列化，超时，重发（重复），消息顺序，负载 等等。（个人理解）

  - 协议：thrift 等等
  - JavaRMI
    - [深究Java中的RMI底层原理](https://blog.csdn.net/sinat_34596644/article/details/52599688)
  - HSF
    阿里巴巴集团内部使用的分布式服务框架 High Speed Framework

- 分布式锁

  分布式锁一般有三种实现方式：1. 数据库乐观锁；2. 基于Redis的分布式锁；3. 基于ZooKeeper的分布式锁

- 分布式事务

  - [分布式事务与一致性算法Paxos & raft & zab](https://blog.csdn.net/followmyinclinations/article/details/52870418)
  - atomikos:[4.0 atomikos JTA/XA全局事务](http://www.tianshouzhi.com/api/tutorials/distributed_transaction/386)
  - xaresource
  - [分布式事务](https://javatar.iteye.com/blog/981787)
  - [分布式事务系列（2.1）分布式事务的概念](https://yq.aliyun.com/articles/39047)



### 分布式 session 一致性

1. session复制，对web服务器(例如Tomcat)进行搭建集群
2. session绑定，使用nginx `ip-hash策略`，无论客户端发送多少次请求都被同一个服务器处理
3. 基于redis存储，spring为我们封装好了spring-session，直接引入依赖即可



### 高可用技术

- 服务器端如何处理超大量合法请求？

  服务器架构层面，做负载均衡，将请求分发给其它服务器处理。

  软件服务架构层面，做请求队列，将1w个请求放入队列，业务处理完的请求再返回。

  代码层面，优化业务处理，把单机请求做到支持1w并发。





## 前沿技术

Docker、中台、ServiceMesh(服务网格)

大数据、人工智能、区块链等